################################################
#Modulo 2 - Segunda parte - seleccion de variables
################################################
library(dplyr)
library(readr)
agregados <- read_csv("C:/cursoR/agregados.csv")
View(agregados)
cmadrid<-filter(agregados, CCAA=="CM")
View(cmadrid)

Madrid.fallecidos<-select(cmadrid, FECHA, Fallecidos)
plot(Madrid.fallecidos$Fallecidos, col='red', main="fallecidos en CM")
#
cmadrid<-select(cmadrid, -CCAA)
#
cmadrid<-rename(cmadrid, Infectados=CASOS)
#
#Madrid.PCR<-select(cmadrid, PCR+) #da error por el signo +
names(cmadrid) #observo cual es la lista de nombres de las variables
names(cmadrid)[3]<-"PRC" #modifico el nombre de la variable tercera
names(cmadrid)[4]<-"TestAC" #idem
names(cmadrid)#compruebo el resultado

#calculamos nuevas variables o modificacamos una existente
cmadrid<-mutate(cmadrid, Infectados=PRC+TestAC)
plot(cmadrid$Infectados) #se observa que faltan muchos datos
#Observamos el problema de demasiados NA, en este caso, lo sencillo
#es sustituir los NA por ceros
#Una forma de hacerlo es esta:
tam<-dim(cmadrid)
for (i in 1:tam[1]){
  for (j in 1:tam[2]){
    if (is.na(cmadrid[i,j])) {cmadrid[i,j]<-0}
  }
}
#Ahora debo volver a recalcular Infectados (39) y a replotear (40)

#Calculamos el indice de transmision R con referencia a 14 dias:
attach(cmadrid)
Rindex<-rep(0,length(Infectados))
for (i in (15:length(Infectados))){
  Rindex[i]<-Infectados[i]/Infectados[i-14]
}
detach(cmadrid)
#creamos una nueva variable en el dataset cmadrid
cmadrid<-mutate(cmadrid, RIndex=Rindex)

#Evolucion del numero R de transmision del covid19
plot(Rindex,col="red", type="l")
#Observamos los valores de la columna RIndex en la tabla cmadrid
#Ceros- Inf (Infinito) - valores reales

#Aqui empieza el trabajo practico:
#1.Comenta las siguientes instrucciones:
datos.ac1<-select(cmadrid,FECHA, Infectados, Hospitalizados:Fallecidos)
#
datos.ac2<-select(cmadrid,1:2, 5:7)
#
Dia<-1:length(cmadrid$FECHA)
#
mascmadrid<-mutate(cmadrid, DIA=Dia)
#
plot(mascmadrid$DIA, mascmadrid$Infectados, 
     xlab= "D?a", ylab="Infectados",main="Infecciones en la CM por d?a")
# 
#
#2. Calcula una nueva variable en cmadrid que contenga el resultado de:
#Infectados-(Hospitalizados+UCI+Fallecidos)


#3. Representa los resultados de esa variable desde la fecha disponible




